From 94e97aaaf2296088858aef4fc13006ae56b1a9ee Mon Sep 17 00:00:00 2001
From: Rafael Palomar <rafael.palomar@ous-research.no>
Date: Thu, 9 Feb 2023 16:33:11 +0100
Subject: [PATCH] ENH: Make Segmentations a separate module

---
 Modules/Loadable/Segmentations/CMakeLists.txt  | 16 +++++++++++++---
 .../Segmentations/EditorEffects/CMakeLists.txt | 14 ++++++++++----
 .../Segmentations/Logic/CMakeLists.txt         |  6 ++++--
 .../Loadable/Segmentations/MRML/CMakeLists.txt |  2 ++
 .../SubjectHierarchyPlugins/CMakeLists.txt     | 18 +++++++++++++-----
 .../Segmentations/Widgets/CMakeLists.txt       |  3 ++-
 6 files changed, 44 insertions(+), 15 deletions(-)

diff --git a/Modules/Loadable/Segmentations/CMakeLists.txt b/Modules/Loadable/Segmentations/CMakeLists.txt
index 7cdd231b04..eac659a972 100644
--- a/Modules/Loadable/Segmentations/CMakeLists.txt
+++ b/Modules/Loadable/Segmentations/CMakeLists.txt
@@ -1,8 +1,18 @@
+#-----------------------------------------------------------------------------
+cmake_minimum_required(VERSION 3.16.3...3.19.7 FATAL_ERROR)
+
+#-----------------------------------------------------------------------------
+project(Segmentations)
+
 #-----------------------------------------------------------------------------
 set(MODULE_NAME "Segmentations")
 
 string(TOUPPER ${MODULE_NAME} MODULE_NAME_UPPER)
 
+#-----------------------------------------------------------------------------
+find_package(Slicer REQUIRED)
+include(${Slicer_USE_FILE})
+
 #-----------------------------------------------------------------------------
 add_subdirectory(MRML)
 add_subdirectory(Logic)
@@ -21,9 +31,9 @@ set(MODULE_INCLUDE_DIRECTORIES
   ${qSlicerSegmentationsModuleWidgets_INCLUDE_DIRS}
   ${qSlicerSegmentationsEditorEffects_INCLUDE_DIRS}
   ${qSlicerSegmentationsSubjectHierarchyPlugins_INCLUDE_DIRS}
-  ${qSlicerSubjectHierarchyModuleWidgets_INCLUDE_DIRS}
-  ${qSlicerTerminologiesModuleWidgets_INCLUDE_DIRS}
-  ${vtkSlicerTerminologiesModuleLogic_INCLUDE_DIRS}
+  ${Slicer_INSTALL_QTLOADABLEMODULES_INCLUDE_DIR}/qSlicerSubjectHierarchyModuleWidgets
+  ${Slicer_INSTALL_QTLOADABLEMODULES_INCLUDE_DIR}/qSlicerTerminologiesModuleWidgets
+  ${Slicer_INSTALL_QTLOADABLEMODULES_INCLUDE_DIR}/vtkSlicerTerminologiesModuleLogic
   )
 
 set(MODULE_SRCS
diff --git a/Modules/Loadable/Segmentations/EditorEffects/CMakeLists.txt b/Modules/Loadable/Segmentations/EditorEffects/CMakeLists.txt
index 32a939316f..06da17824b 100644
--- a/Modules/Loadable/Segmentations/EditorEffects/CMakeLists.txt
+++ b/Modules/Loadable/Segmentations/EditorEffects/CMakeLists.txt
@@ -9,10 +9,9 @@ set(${KIT}_INCLUDE_DIRECTORIES
   ${vtkSlicerSegmentationsModuleMRMLDisplayableManager_INCLUDE_DIRS}
   ${vtkSlicerSegmentationsModuleLogic_INCLUDE_DIRS}
   ${Slicer_Base_INCLUDE_DIRS}
-  ${qMRMLWidgets_INCLUDE_DIRS}
-  ${MRMLLogic_INCLUDE_DIRS}
-  ${MRMLCore_INCLUDE_DIRS}
-  ${MRMLDisplayableManager_INCLUDE_DIRS}
+  ${Slicer_Libs_INCLUDE_DIRS}
+  ${MRML_INCLUDE_DIRS}
+  ${vtkAddon_INCLUDE_DIRS}
   )
 
 set(${KIT}_SRCS
@@ -78,8 +77,15 @@ set(${KIT}_TARGET_LIBRARIES
   MRMLLogic
   MRMLCore
   qSlicerBaseQTGUI # required for access to qSlicerApplication singletons
+  qSlicerBaseQTCore# required for access to qSlicerApplication singletons
+  vtkAddon
+  Qt::Xml
+  ${CTK_LIBRARIES}
   )
 
+add_definitions(-DCTK_USE_QVTKOPENGLWIDGET -DCTK_HAS_QVTKOPENGLNATIVEWIDGET_H)
+link_directories(${Slicer_INSTALL_QTLOADABLEMODULES_LIB_DIR})
+
 #-----------------------------------------------------------------------------
 SlicerMacroBuildModuleQtLibrary(
   NAME ${KIT}
diff --git a/Modules/Loadable/Segmentations/Logic/CMakeLists.txt b/Modules/Loadable/Segmentations/Logic/CMakeLists.txt
index d3dda18186..329c2884cf 100644
--- a/Modules/Loadable/Segmentations/Logic/CMakeLists.txt
+++ b/Modules/Loadable/Segmentations/Logic/CMakeLists.txt
@@ -6,8 +6,9 @@ set(${KIT}_EXPORT_DIRECTIVE "VTK_SLICER_${MODULE_NAME_UPPER}_LOGIC_EXPORT")
 
 set(${KIT}_INCLUDE_DIRECTORIES
   ${vtkSlicerSegmentationsModuleMRML_INCLUDE_DIRS}
-  ${vtkSlicerTerminologiesModuleLogic_INCLUDE_DIRS}
-  ${vtkSlicerMarkupsModuleMRML_INCLUDE_DIRS}
+  ${Slicer_INSTALL_QTLOADABLEMODULES_INCLUDE_DIR}/vtkSlicerTerminologiesModuleLogic
+  ${Slicer_INSTALL_QTLOADABLEMODULES_INCLUDE_DIR}/vtkSlicerMarkupsModuleMRML
+  ${Slicer_Libs_INCLUDE_DIRS}
   )
 
 set(${KIT}_SRCS
@@ -24,6 +25,7 @@ set(${KIT}_TARGET_LIBRARIES
   vtkSlicer${MODULE_NAME}ModuleMRML
   vtkSlicerTerminologiesModuleLogic
   vtkSlicerMarkupsModuleMRML
+  vtkITK
   )
 
 #-----------------------------------------------------------------------------
diff --git a/Modules/Loadable/Segmentations/MRML/CMakeLists.txt b/Modules/Loadable/Segmentations/MRML/CMakeLists.txt
index c93f448fa3..2972b4a1cd 100644
--- a/Modules/Loadable/Segmentations/MRML/CMakeLists.txt
+++ b/Modules/Loadable/Segmentations/MRML/CMakeLists.txt
@@ -23,6 +23,8 @@ set(${KIT}_TARGET_LIBRARIES
   vtkSlicerSubjectHierarchyModuleLogic
   )
 
+link_directories(${Slicer_INSTALL_QTLOADABLEMODULES_LIB_DIR})
+
 # --------------------------------------------------------------------------
 SlicerMacroBuildModuleMRML(
   NAME ${KIT}
diff --git a/Modules/Loadable/Segmentations/SubjectHierarchyPlugins/CMakeLists.txt b/Modules/Loadable/Segmentations/SubjectHierarchyPlugins/CMakeLists.txt
index 327791ec43..0ab3066ddc 100644
--- a/Modules/Loadable/Segmentations/SubjectHierarchyPlugins/CMakeLists.txt
+++ b/Modules/Loadable/Segmentations/SubjectHierarchyPlugins/CMakeLists.txt
@@ -8,12 +8,14 @@ set(${KIT}_INCLUDE_DIRECTORIES
   ${vtkSlicerSegmentationsModuleMRML_INCLUDE_DIRS}
   ${vtkSlicerSegmentationsModuleLogic_INCLUDE_DIRS}
   ${qSlicerSegmentationsModule_INCLUDE_DIRS}
-  ${qSlicerSubjectHierarchyModuleWidgets_INCLUDE_DIRS}
-  ${vtkSlicerSubjectHierarchyModuleLogic_INCLUDE_DIRS}
-  ${qSlicerTerminologiesModuleWidgets_INCLUDE_DIRS}
+  ${Slicer_INSTALL_QTLOADABLEMODULES_INCLUDE_DIR}/qSlicerSubjectHierarchyModuleWidgets
+  ${Slicer_INSTALL_QTLOADABLEMODULES_INCLUDE_DIR}/vtkSlicerSubjectHierarchyModuleLogic
+  ${Slicer_INSTALL_QTLOADABLEMODULES_INCLUDE_DIR}/qSlicerTerminologiesModuleWidgets
   ${qMRMLWidgets_INCLUDE_DIRS}
-  ${MRMLLogic_INCLUDE_DIRS}
-  ${MRMLCore_INCLUDE_DIRS}
+  ${MRML_INCLUDE_DIRS}
+  ${vtkAddon_INCLUDE_DIRS}
+  ${Slicer_Libs_INCLUDE_DIRS}
+  ${Slicer_Base_INCLUDE_DIRS}
   )
 
 set(${KIT}_SRCS
@@ -44,8 +46,14 @@ set(${KIT}_TARGET_LIBRARIES
   qMRMLWidgets
   MRMLLogic
   MRMLCore
+  vtkAddon
+  Qt::Xml
+  ${Slicer_Base_LIBRARIES}
+  ${CTK_LIBRARIES}
   )
 
+link_directories(${Slicer_INSTALL_QTLOADABLEMODULES_LIB_DIR})
+
 #-----------------------------------------------------------------------------
 SlicerMacroBuildModuleQtLibrary(
   NAME ${KIT}
diff --git a/Modules/Loadable/Segmentations/Widgets/CMakeLists.txt b/Modules/Loadable/Segmentations/Widgets/CMakeLists.txt
index 99389d32fc..d84e15a81b 100644
--- a/Modules/Loadable/Segmentations/Widgets/CMakeLists.txt
+++ b/Modules/Loadable/Segmentations/Widgets/CMakeLists.txt
@@ -8,7 +8,8 @@ set(${KIT}_INCLUDE_DIRECTORIES
   ${vtkSlicerSegmentationsModuleMRML_INCLUDE_DIRS}
   ${vtkSlicerSegmentationsModuleLogic_INCLUDE_DIRS}
   ${qSlicerSegmentationsEditorEffects_INCLUDE_DIRS}
-  ${qSlicerTerminologiesModuleWidgets_INCLUDE_DIRS}
+  ${Slicer_INSTALL_QTLOADABLEMODULES_INCLUDE_DIR}/qSlicerTerminologiesModuleWidgets
+  ${Slicer_INSTALL_QTLOADABLEMODULES_INCLUDE_DIR}/vtkSlicerTerminologiesModuleLogic
   )
 
 set(${KIT}_SRCS
-- 
2.39.2

