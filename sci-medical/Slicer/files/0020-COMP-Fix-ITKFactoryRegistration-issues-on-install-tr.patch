From 8d63cbadee8081919817a1b47bdb0423fbf8e235 Mon Sep 17 00:00:00 2001
From: Rafael Palomar <rafael.palomar@rr-research.no>
Date: Thu, 23 Jan 2020 15:46:09 +0100
Subject: [PATCH 20/30] COMP: Fix ITKFactoryRegistration issues on install tree

---
 Base/CLI/CMakeLists.txt                    | 4 ++++
 CMake/SlicerDirectories.cmake              | 1 +
 CMake/SlicerInstallConfig.cmake.in         | 3 +++
 Libs/ITKFactoryRegistration/CMakeLists.txt | 4 ++--
 4 files changed, 10 insertions(+), 2 deletions(-)

diff --git a/Base/CLI/CMakeLists.txt b/Base/CLI/CMakeLists.txt
index 99474cf653..974bde257f 100644
--- a/Base/CLI/CMakeLists.txt
+++ b/Base/CLI/CMakeLists.txt
@@ -75,6 +75,10 @@ if(NOT ${PROJECT_NAME}_INSTALL_NO_DEVELOPMENT)
   install(
     FILES ${headers} ${CMAKE_CURRENT_BINARY_DIR}/${configure_header_file}
     DESTINATION ${Slicer_INSTALL_INCLUDE_DIR}/${PROJECT_NAME} COMPONENT Development)
+  install(
+    FILES ${SlicerExecutionModel_CLI_LIBRARY_WRAPPER_CXX}
+    DESTINATION "${Slicer_INSTALL_SHARE_DIR}"
+    )
 endif()
 
 # --------------------------------------------------------------------------
diff --git a/CMake/SlicerDirectories.cmake b/CMake/SlicerDirectories.cmake
index 17a8e5461b..d835eab1e0 100644
--- a/CMake/SlicerDirectories.cmake
+++ b/CMake/SlicerDirectories.cmake
@@ -75,6 +75,7 @@ set(Slicer_INSTALL_INCLUDE_DIR "${Slicer_INSTALL_ROOT}${Slicer_INCLUDE_DIR}")
 set(Slicer_INSTALL_SHARE_DIR "${Slicer_INSTALL_ROOT}${Slicer_SHARE_DIR}")
 set(Slicer_INSTALL_LIBEXEC_DIR "${Slicer_INSTALL_ROOT}${Slicer_LIBEXEC_DIR}")
 set(Slicer_INSTALL_ITKFACTORIES_DIR "${Slicer_INSTALL_LIB_DIR}/ITKFactories")
+set(Slicer_INSTALL_ITKFACTORYREGISTRATION_INCLUDE_DIR "${Slicer_INSTALL_ROOT}/include/ITKFactoryRegistration")
 set(Slicer_INSTALL_QM_DIR "${Slicer_INSTALL_ROOT}${Slicer_QM_DIR}")
 
 
diff --git a/CMake/SlicerInstallConfig.cmake.in b/CMake/SlicerInstallConfig.cmake.in
index 7c8be7076c..aa4cf5b0e2 100644
--- a/CMake/SlicerInstallConfig.cmake.in
+++ b/CMake/SlicerInstallConfig.cmake.in
@@ -82,6 +82,7 @@ set(Slicer_Libs_INCLUDE_DIRS
   "${Slicer_HOME}/include/vtkTeem"
   "${Slicer_HOME}/include/SlicerBaseLogic"
   "${Slicer_HOME}/include/qMRMLWidgets"
+  "${Slicer_HOME}/include/ITKFactoryRegistration"
   )
 
 # Slicer Base library directories.
@@ -159,3 +160,5 @@ set(Slicer_LOGOS_RESOURCE "${Slicer_HOME}/${Slicer_INSTALL_SHARE_DIR}/Resources/
 
 # MRML libraries - This variable regroup all related MRML libraries
 set(MRML_LIBRARIES @MRML_LIBRARIES@)
+
+set(SlicerExecutionModel_DEFAULT_CLI_LIBRARY_WRAPPER_CXX "${Slicer_HOME}/${Slicer_INSTALL_SHARE_DIR}/SEMCommandLineLibraryWrapper.cxx")
diff --git a/Libs/ITKFactoryRegistration/CMakeLists.txt b/Libs/ITKFactoryRegistration/CMakeLists.txt
index 31f63b69c3..c5b561f463 100644
--- a/Libs/ITKFactoryRegistration/CMakeLists.txt
+++ b/Libs/ITKFactoryRegistration/CMakeLists.txt
@@ -71,10 +71,10 @@ if(NOT DEFINED ${PROJECT_NAME}_INSTALL_NO_DEVELOPMENT)
   set(${PROJECT_NAME}_INSTALL_NO_DEVELOPMENT ${Slicer_INSTALL_NO_DEVELOPMENT})
 endif()
 if(NOT ${PROJECT_NAME}_INSTALL_NO_DEVELOPMENT)
-  file(GLOB headers "${CMAKE_CURRENT_SOURCE_DIR}/*.(h|txx)")
+  file(GLOB headers "${CMAKE_CURRENT_SOURCE_DIR}/*.h")
   install(
     FILES ${headers} ${CMAKE_CURRENT_BINARY_DIR}/${configure_header_file}
-    DESTINATION include/${PROJECT_NAME} COMPONENT Development)
+    DESTINATION ${Slicer_INSTALL_ITKFACTORYREGISTRATION_INCLUDE_DIR} COMPONENT Development)
 endif()
 
 # --------------------------------------------------------------------------
-- 
2.26.2

