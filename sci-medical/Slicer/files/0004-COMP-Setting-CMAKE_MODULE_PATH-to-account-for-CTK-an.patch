From e43e972ed12f6279b8f9d5f1c73cbe316320b9b1 Mon Sep 17 00:00:00 2001
From: Rafael Palomar <rafael.palomar@rr-research.no>
Date: Thu, 3 Oct 2019 10:33:44 +0200
Subject: [PATCH 04/30] COMP: Setting CMAKE_MODULE_PATH to account for CTK and
 Slicer

---
 CMake/SlicerInstallConfig.cmake.in | 1 +
 CMake/UseSlicer.cmake.in           | 6 +++++-
 CMakeLists.txt                     | 2 +-
 3 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/CMake/SlicerInstallConfig.cmake.in b/CMake/SlicerInstallConfig.cmake.in
index fad1a78b84..c5a62b8061 100644
--- a/CMake/SlicerInstallConfig.cmake.in
+++ b/CMake/SlicerInstallConfig.cmake.in
@@ -131,3 +131,4 @@ get_filename_component(PYTHON_LIB_FILE "${PYTHON_LIBRARY}" NAME)
 set(PYTHON_LIBRARIES "${Slicer_HOME}/lib/Python/lib/${PYTHON_LIB_FILE}")
 get_filename_component(PYTHON_INCLUDE_DIR "${PYTHON_INCLUDE_PATH}" NAME)
 set(PYTHON_INCLUDE_PATH "${Slicer_HOME}/lib/Python/include/${PYTHON_INCLUDE_DIR}")
+set(CTK_CMAKE_DIR "@CTK_CMAKE_DIR@")
diff --git a/CMake/UseSlicer.cmake.in b/CMake/UseSlicer.cmake.in
index f974ce4c42..ecadb9c484 100644
--- a/CMake/UseSlicer.cmake.in
+++ b/CMake/UseSlicer.cmake.in
@@ -39,6 +39,10 @@
 # This is can avoided by setting the variable Slicer_VERBOSE_SKIP to TRUE
 #
 
+set(CMAKE_MODULE_PATH
+  "@CTK_CMAKE_DIR@"
+  "${Slicer_CMAKE_DIR}")
+
 # --------------------------------------------------------------------------
 # Helper function(s) and macro(s)
 # --------------------------------------------------------------------------
@@ -156,7 +160,7 @@ if(NOT DEFINED Slicer_SKIP_EXTERNAL_DATA)
 endif()
 if(NOT ${Slicer_SKIP_EXTERNAL_DATA})
   set(ExternalData_OBJECT_STORES ${Slicer_ExternalData_OBJECT_STORES})
-  set(ExternalData_URL_TEMPLATES ${Slicer_ExternalData_URL_TEMPLATES})
+  set(ExternalData_URL_TEMPLATES "${Slicer_ExternalData_URL_TEMPLATES}")
 else()
   _slicer_skip_message("Slicer_ExternalData")
 endif()
diff --git a/CMakeLists.txt b/CMakeLists.txt
index 7fde8669d1..9b8b20bd02 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -968,7 +968,7 @@ add_subdirectory(
 set(Slicer_USE_FILE ${Slicer_BINARY_DIR}/UseSlicer.cmake)
 configure_file(
   ${Slicer_SOURCE_DIR}/CMake/UseSlicer.cmake.in
-  ${Slicer_USE_FILE} COPYONLY)
+  ${Slicer_USE_FILE} @ONLY)
 
 configure_file(
   ${Slicer_SOURCE_DIR}/CMake/SlicerConfigVersion.cmake.in
-- 
2.26.2

